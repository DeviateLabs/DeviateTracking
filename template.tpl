___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "123 Deviate Tracking Facebook Conversions API Tag",
  "categories": [
    "CONVERSIONS",
    "ADVERTISING",
    "ATTRIBUTION",
    "REMARKETING"
  ],
  "brand": {
    "id": "Deviate Tracking",
    "displayName": "Deviate Tracking",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAwCAYAAACBpyPiAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjA3RDBFNzA3QjJFMTFFQjg5ODBEQzdCQTk1RDdDMkYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MjA3RDBFNkY3QjJFMTFFQjg5ODBEQzdCQTk1RDdDMkYiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QjBEMzlFOUU3QjJDMTFFQkI5MUVFNTExQzVDMjUzOUIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QjBEMzlFOUY3QjJDMTFFQkI5MUVFNTExQzVDMjUzOUIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7TfI3FAAAD80lEQVR42uxZaUhVQRS+155LD0mTENslIgssUIkksUDCsJWizFaK6JcZFFJCVLgEURRESvXLzJL8IdliUUILGEWJ1VPbCyJaNJUywszk9Z04xu029777nhNN4YGPuW9m7plv5s5ZZp6uSRBvg5aA4hAwHdBtuj4AtuqJWo2McXUJxEeiaAIiHb7SC6RiAjf7O3aQhAVY5wdxkkFAjoyVl0F+VADvjFCFfGMA7zSpQv4Y0OxH/zZgrxIGy0YbhWIbMAMYbNHtK3AfKIKxvtQG5B8WXbbCd6uLw1HEA2Fc1QM8iSnf+F5p8iCejWKfYN9TYDoI5GISXlnjBUkkPgtFsYXBUmDaAmTLXKwgibpWOeizRlXy4Q76DFGVfJ2DPtdVJX/ExwSeA7uke5uUC3luFIuB4cCdG3P2XAvQaENQLAeSDYbbzXl8KTxNZyB6wS8axULedrXg5/lBHg2xKK8CsYb+lcBKdOr924EI/CjlOAtEGKp3gluhCw8lJuIky4CLQJmxMu1yTxKK+cA3oPpKenC/skPooy+fQYcToBWogM4WA3FysSdMxEkK0Hae9ny6he7ZpoE2o6jnfVtISRbq1lomawlT3ECEDXEa+xRAR8I84ADwkBeoT+KA0Vb8SIHLotFtGGgsR06zsZegLcpEehhQhcdPwAc81wFxAv1LgExT3VDgqOF3iM2HC3PqbVI5SoommGyqq2Lj79OdAlzCBMyRN81irCQsSKRMV+myaQsxrHo85/RmoS8317xyNjqlkncq0TZtMbI9kWzyjZwCi6TeDz29Msl32LT9zNP1ux56LhD0qUDbLVNdi81xsVUm+VrglaCeDt6/kALJIhSLONCdATZYZJPHLb5SOXx9t1NDpFWNErS96XuAsi54gAz2y/FcfZtSAbT99okxgWoKYnYD471m6MzC42G2FS9PeJPoqwrkLaUH+RRuTQ0UQachBDcIgss42pMYXMoNAPTRAo4notDZLkgP6OstEFyfTHTxHiUfnMPui7ZHjog4r9gLmRYOfbRQj3wcYChwLeVtfg9YD37tumGGoexfW9Hg1RQTznzd4Nb2pw7gFKD2U5Q06X4K7EBKXKnk7QGIT0LR4CNyzsMEamSNKTNIZfsgrvENgpIR1slV9xhVyTu56vaoSp7+k3pt094F5CtpsGy09P/UdmAqEGxIsh4Du2GszdqA/Aci658RSjOy+LgYatGNMkj6Z6RUT9Q+K0EexOlse46vMJx6Jfof9qMK3ibTD+Ikk4FcVVzlzEDyLFXIdwTwTqcq5E/aHLqtpEwJ8jA8CjwrgHYH3b/Qfsc7p5WKsPA65CInaOKbNY3PqM9kuUmS7wIMAK8jE4sOmQS5AAAAAElFTkSuQmCC"
  },
  "description": "A server-side tag template that prepares information from your tagging server to be sent through Facebookâ€™s Conversions API.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "Notice",
    "displayName": "This tracking tag type requires a paid subscription, you can sign up for a free trial at https://deviatetracking.com",
    "enablingConditions": [
      {
        "paramName": "pixelId",
        "paramValue": "",
        "type": "NOT_PRESENT"
      },
      {
        "paramName": "FBToken",
        "paramValue": "",
        "type": "NOT_PRESENT"
      },
      {
        "paramName": "apiAccessToken",
        "paramValue": "",
        "type": "NOT_PRESENT"
      },
      {
        "paramName": "LicensedEmail",
        "paramValue": "",
        "type": "NOT_PRESENT"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "pixelId",
    "displayName": "Facebook Pixel ID",
    "simpleValueType": true,
    "help": "Please follow these instructions to get your Facebook Pixel ID: https://www.facebook.com/business/help/952192354843755"
  },
  {
    "type": "TEXT",
    "name": "FBToken",
    "displayName": "Facebook Token",
    "simpleValueType": true,
    "help": "Please review the help documentation to get an access token: https://developers.facebook.com/docs/marketing-api/conversions-api/get-started#access-token"
  },
  {
    "type": "TEXT",
    "name": "apiAccessToken",
    "displayName": "Deviate Tracking License Key",
    "simpleValueType": true,
    "help": "This key will be provided to you via Email on purchase, if you didn\u0027t receive this, please contact us at hello@deviatetracking.com"
  },
  {
    "type": "TEXT",
    "name": "LicensedEmail",
    "displayName": "Deviate Tracking Licensed Email",
    "simpleValueType": true,
    "help": "This is the email that you used when you purchased a key, if you are getting an error please email us at hello@deviatetracking.com"
  },
  {
    "type": "SELECT",
    "name": "StandardEvents",
    "displayName": "Facebook Standard Event Name",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "AddPaymentInfo",
        "displayValue": "AddPaymentInfo"
      },
      {
        "value": "AddToCart",
        "displayValue": "AddToCart"
      },
      {
        "value": "AddToWishlist",
        "displayValue": "AddToWishlist"
      },
      {
        "value": "CompleteRegistration",
        "displayValue": "CompleteRegistration"
      },
      {
        "value": "Contact",
        "displayValue": "Contact"
      },
      {
        "value": "CustomizeProduct",
        "displayValue": "CustomizeProduct"
      },
      {
        "value": "Donate",
        "displayValue": "Donate"
      },
      {
        "value": "FindLocation",
        "displayValue": "FindLocation"
      },
      {
        "value": "InitiateCheckout",
        "displayValue": "InitiateCheckout"
      },
      {
        "value": "Lead",
        "displayValue": "Lead"
      },
      {
        "value": "PageView",
        "displayValue": "PageView"
      },
      {
        "value": "Purchase",
        "displayValue": "Purchase"
      },
      {
        "value": "Schedule",
        "displayValue": "Schedule"
      },
      {
        "value": "Search",
        "displayValue": "Search"
      },
      {
        "value": "StartTrial",
        "displayValue": "StartTrial"
      },
      {
        "value": "SubmitApplication",
        "displayValue": "SubmitApplication"
      },
      {
        "value": "Subscribe",
        "displayValue": "Subscribe"
      },
      {
        "value": "ViewContent",
        "displayValue": "ViewContent"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "PageView",
    "help": "You can use as many different types as you\u0027d like, but Facebook limits their aggregated data set to only up to a maximum of 8 events, which can be set in the event manager. Use the drop down and choose a type of event to track standard events. Standard events also support parameter objects with specific object properties, which allow you to include detailed information about an event. For a full description of events please visit https://developers.facebook.com/docs/facebook-pixel/reference"
  },
  {
    "type": "LABEL",
    "name": "Purchase Type Notice",
    "displayName": "**Currency Type and Purchase Value MUST be set in OBJECT PROPERTIES or no events will be submitted**",
    "enablingConditions": [
      {
        "paramName": "StandardEvents",
        "paramValue": "Purchase",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "ObjectProperties",
    "displayName": "Object Property",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "DeduplicationEventID",
        "displayName": "Deduplication Event ID",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "help": "Providing an event ID, can help reduce the amount of events that are duplicated when using in conjunction with regular JavaScript FBQ events. We recommend setting a random variable and setting this parameter to it to avoid duplicated event data.",
        "defaultValue": "EventId"
      },
      {
        "type": "TEXT",
        "name": "content_category",
        "displayName": "content_category",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddPaymentInfo",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Lead",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Search",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "help": "Category of the page/product."
      },
      {
        "type": "TEXT",
        "name": "content_ids",
        "displayName": "content_ids",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddPaymentInfo",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Search",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "help": "Product IDs associated with the event, such as SKUs"
      },
      {
        "type": "TEXT",
        "name": "content_name",
        "displayName": "content_name",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "CompleteRegistration",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Lead",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "help": "Name of the page/product"
      },
      {
        "type": "TEXT",
        "name": "content_type",
        "displayName": "content_type",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "help": "Either product or product_group based on the content_ids or contents being passed. If the IDs being passed in content_ids or contents parameter are IDs of products then the value should be product. If product group IDs are being passed, then the value should be product_group."
      },
      {
        "type": "TEXT",
        "name": "contents",
        "displayName": "contents",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddPaymentInfo",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Search",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "help": "An array of JSON objects that contains the quantity and the International Article Number (EAN) when applicable, or other product or content identifier(s). id and quantity are the required fields."
      },
      {
        "type": "SELECT",
        "name": "currency",
        "displayName": "currency",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "DZD",
            "displayValue": "Algerian Dinar"
          },
          {
            "value": "ARS",
            "displayValue": "Argentine Peso"
          },
          {
            "value": "AUD",
            "displayValue": "Australian Dollar"
          },
          {
            "value": "BDT",
            "displayValue": "Bangladeshi Taka"
          },
          {
            "value": "BOB",
            "displayValue": "Bolivian Boliviano"
          },
          {
            "value": "BRL",
            "displayValue": "Brazilian Real"
          },
          {
            "value": "GBP",
            "displayValue": "British Pound"
          },
          {
            "value": "CAD",
            "displayValue": "Canadian Dollar"
          },
          {
            "value": "CLP",
            "displayValue": "Chilean Peso"
          },
          {
            "value": "CNY",
            "displayValue": "Chinese Yuan"
          },
          {
            "value": "COP",
            "displayValue": "Colombian Peso"
          },
          {
            "value": "CRC",
            "displayValue": "Costa Rican Colon"
          },
          {
            "value": "CZK",
            "displayValue": "Czech Koruna"
          },
          {
            "value": "DKK",
            "displayValue": "Danish Krone"
          },
          {
            "value": "EGP",
            "displayValue": "Egyptian Pounds"
          },
          {
            "value": "EUR",
            "displayValue": "Euro"
          },
          {
            "value": "GTQ",
            "displayValue": "Guatemalan Quetza"
          },
          {
            "value": "HNL",
            "displayValue": "Honduran Lempira"
          },
          {
            "value": "HKD",
            "displayValue": "Hong Kong Dollar"
          },
          {
            "value": "ISK",
            "displayValue": "Iceland Krona"
          },
          {
            "value": "INR",
            "displayValue": "Indian Rupee"
          },
          {
            "value": "IDR",
            "displayValue": "Indonesian Rupiah"
          },
          {
            "value": "ILS",
            "displayValue": "Israeli New Shekel"
          },
          {
            "value": "JPY",
            "displayValue": "Japanese Yen"
          },
          {
            "value": "KES",
            "displayValue": "Kenyan Shilling"
          },
          {
            "value": "KRW",
            "displayValue": "Korean Won"
          },
          {
            "value": "MOP",
            "displayValue": "Macau Patacas"
          },
          {
            "value": "MYR",
            "displayValue": "Malaysian Ringgit"
          },
          {
            "value": "MXN",
            "displayValue": "Mexican Peso"
          },
          {
            "value": "NZD",
            "displayValue": "New Zealand Dollar"
          },
          {
            "value": "NIO",
            "displayValue": "Nicaraguan Cordoba"
          },
          {
            "value": "NGN",
            "displayValue": "Nigerian Naira"
          },
          {
            "value": "NOK",
            "displayValue": "Norwegian Krone"
          },
          {
            "value": "PKR",
            "displayValue": "Pakistani Rupee"
          },
          {
            "value": "PYG",
            "displayValue": "Paraguayan Guarani"
          },
          {
            "value": "PEN",
            "displayValue": "Peruvian Nuevo Sol"
          },
          {
            "value": "PHP",
            "displayValue": "Philippine Peso"
          },
          {
            "value": "PLN",
            "displayValue": "Polish Zloty"
          },
          {
            "value": "QAR",
            "displayValue": "Qatari Rials"
          },
          {
            "value": "RON",
            "displayValue": "Romanian Leu"
          },
          {
            "value": "RUB",
            "displayValue": "Russian Ruble"
          },
          {
            "value": "SAR",
            "displayValue": "Saudi Arabian Riyal"
          },
          {
            "value": "SGD",
            "displayValue": "Singapore Dollar"
          },
          {
            "value": "ZAR",
            "displayValue": "South African Rand"
          },
          {
            "value": "SEK",
            "displayValue": "Swedish Krona"
          },
          {
            "value": "CHF",
            "displayValue": "Swiss Franc"
          },
          {
            "value": "TWD",
            "displayValue": "Taiwan Dollar"
          },
          {
            "value": "THB",
            "displayValue": "Thai Baht"
          },
          {
            "value": "TRY",
            "displayValue": "Turkish Lira"
          },
          {
            "value": "AED",
            "displayValue": "Uae Dirham"
          },
          {
            "value": "USD",
            "displayValue": "United States Dollar"
          },
          {
            "value": "UYU",
            "displayValue": "Uruguay Peso"
          },
          {
            "value": "VEF",
            "displayValue": "Venezuelan Bolivar"
          },
          {
            "value": "VND",
            "displayValue": "Vietnamese Dong"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddPaymentInfo",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "CompleteRegistration",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Lead",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          }
        ],
        "notSetText": "This parameter is required for the Purchase Event",
        "help": "This parameter is required for the Purchase Event, The currency for the value specified.",
        "defaultValue": "USD"
      },
      {
        "type": "TEXT",
        "name": "num_items",
        "displayName": "num_items",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          }
        ],
        "help": "Used with InitiateCheckout event. The number of items when checkout was initiated."
      },
      {
        "type": "TEXT",
        "name": "predicted_ltv",
        "displayName": "predicted_ltv",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "StartTrial",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Subscribe",
            "type": "EQUALS"
          }
        ],
        "help": "Predicted lifetime value of a subscriber as defined by the advertiser and expressed as an exact value."
      },
      {
        "type": "TEXT",
        "name": "search_string",
        "displayName": "search_string",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "Search",
            "type": "EQUALS"
          }
        ],
        "help": "Used with the Search event. The string entered by the user for the search."
      },
      {
        "type": "SELECT",
        "name": "status",
        "displayName": "status",
        "selectItems": [
          {
            "value": true,
            "displayValue": "true"
          },
          {
            "value": false,
            "displayValue": "false"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "CompleteRegistration",
            "type": "EQUALS"
          }
        ],
        "help": "Used with the CompleteRegistration event, to show the status of the registration."
      },
      {
        "type": "TEXT",
        "name": "value",
        "displayName": "value",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "StandardEvents",
            "paramValue": "AddPaymentInfo",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToCart",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "AddToWishlist",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "CompleteRegistration",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "InitiateCheckout",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Lead",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Purchase",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Search",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "StartTrial",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "Subscribe",
            "type": "EQUALS"
          },
          {
            "paramName": "StandardEvents",
            "paramValue": "ViewContent",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NUMBER"
          }
        ],
        "notSetText": "This parameter is required for the Purchase Event",
        "help": "The value of a user performing this event to the business."
      }
    ],
    "help": "These are extra parameters you can send along with your event, some of which are required by standard events."
  },
  {
    "type": "CHECKBOX",
    "name": "TestEventStatus",
    "checkboxText": "Send as a Test Event?",
    "simpleValueType": true,
    "help": "This enables the use of the the Events Manager test events tool, for more information go here: https://www.facebook.com/business/help/2040882565969969?id\u003d1205376682832142"
  },
  {
    "type": "TEXT",
    "name": "TestEventLabel",
    "displayName": "Test Event Label",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "TestEventStatus",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "help": "This should come from your events manager in the testing events section",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

//permissions and Required Components
const log = require("logToConsole");
const sendPixel = require("sendPixel");
const JSON = require("JSON");
const getTimestamp = require("getTimestampMillis");
const encodeUriComponent = require("encodeUriComponent");
const encodeUri = require("encodeUri");
const getUrl = require("getUrl");
const queryPermission = require("queryPermission");
const setCookie = require("setCookie");
const callInWindow = require("callInWindow");
var copyFromWindow = require("copyFromWindow");
const copyFromDataLayer = require("copyFromDataLayer");
var setInWindow = require("setInWindow");
const createQueue = require("createQueue");
const injectScript = require("injectScript");
const Math = require("Math");
const getCookieValues = require('getCookieValues');


function sendPixelData(){
//timestamp generation
  const evtime = Math.round(getTimestamp() / 1000);
  log(evtime);

  //get customer information parameters

if (getCookieValues('_fbc').length > 0) {
  var fbcid = getCookieValues('_fbc', false)[0];
} 

if (getCookieValues('_fbp').length > 0) {
  var fbpid = getCookieValues('_fbp', false)[0];
} 

  
  // get datalayer window values
  
    const gtmData = copyFromWindow("gtmData");
  log("GTM Data:", gtmData);
  
  
  //get all fields from Tag Template
  const lickey = data.apiAccessToken;
  const licemail = data.LicensedEmail;
  const fbtkn = data.FBToken;
  const testevlabel = data.TestEventLabel;
  const pixelId = data.pixelId;

  const objprop = JSON.stringify([
    {"event_name": data.StandardEvents,
      "event_time": evtime,
      "event_id": data.DeduplicationEventID,
      "event_source_url": getUrl(), "action_source": "website",
      "user_data": {"client_user_agent": gtmData.ua, "client_ip_address": gtmData.ip, "fbc":getCookieValues('_fbc', false)[0], "fbp":getCookieValues('_fbc', false)[0]},
      "custom_data": {"content_category": data.content_category,
        "content_ids": data.content_ids,
        "content_name": data.content_name,
        "content_type": data.content_type,
        "contents": data.contents,
        "currency": data.currency,
        "num_items": data.num_items,
        "predicted_ltv": data.predicted_ltv,
        "search_string": data.search_string,
        "status": data.status,
        "value": data.value},
      "opt_out": false},
  ]);


  //send Get Request to Deviate Tracking API
  //eslint-disable-next-line prefer-template
  const url = "https://wc-service-ert7bqptja-uc.a.run.app/license/validate/?" +
        "license_key=" + encodeUriComponent(lickey) +
        "&email=" + encodeUriComponent(licemail) +
        "&fbaccess_tkn=" + encodeUriComponent(fbtkn) +
        "&additional_data=" + encodeUriComponent(objprop) +
        "&product_id=DeviateToolsCapi_Prod" +
        "&fbpixel_id=" + encodeUriComponent(pixelId) +
        "&test_event_code=" + encodeUriComponent(testevlabel);

  sendPixel(url, data.gtmOnSuccess, data.gtmOnFailure);


  data.gtmOnSuccess();
}

setInWindow("gtmFunction", sendPixelData, true);



function onSuccess(){}
function onFailure(){}
injectScript("https://deviatetracking.com/getuseragent.js", onSuccess, onFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtmFunction"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtmData"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fbc"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fbp"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://deviatetracking.com/getuseragent.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "gtm.UA"
              },
              {
                "type": 1,
                "string": "UA"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "_fbc"
              },
              {
                "type": 1,
                "string": "_fbp"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 3/12/2021, 10:42:29 AM


